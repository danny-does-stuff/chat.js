<!doctype html>
<html>
	<head>
		<title>Chat It UP</title>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font: 13px Helvetica, Arial;
			}

			#main {
				display: flex;
			}

			#left-div {
				width: 100px;
			}

			#right-div {

			}

			.option {
				height: 30px;
			}

			#message-container {
				background: #000;
				padding: 3px;
				position: fixed;
				bottom: 0;
				width: 100%;
			}

			#message-container input {
				border: 0;
				padding: 10px;
				width: 90%;
				margin-right: .5%;
			}

			#message-container button {
				width: 9%;
				background: rgb(130, 224, 255);
				border: none;
				padding: 10px;
			}

			#messages, #bot-messages {
				list-style-type: none;
				margin: 0;
				padding: 0;
			}

			#messages li, #bot-messages li {
				padding: 5px 10px;
			}

			#messages li:nth-child(odd), #bot-messages li:nth-child(odd) {
				background: #eee;
			}

			.sender {
				font-weight: bold;
				font-size: 16px;
				padding-right: 8px;
			}

		</style>
	</head>
	<script src="/socket.io/socket.io.js"></script>
	<script src="https://code.jquery.com/jquery-1.11.1.js"></script>
	<script>
		var username;

		$(function () {
			var socket = io();
			var usingChatbot = false;

			$('#message-text').keypress(function(e) {
				if (e.keyCode == 13) {
					$('#send-button').click();
				}
			});

			$('#send-button').click(function(e) {
				var message = {
					user: username,
					text: $('#message-text').val(),
					time: new Date(),
					useBot: usingChatbot
				};

				socket.emit('chat message', message);
				addMessage(message);
				$('#message-text').val('');
			});

			$('.option').click(function() {
				if ($(this).attr('id') == 'bot') {
					console.log('bot')
					usingChatbot = true;
					$('#messages').hide();
					$('#bot-messages').show();
				} else {
					console.log('not')
					usingChatbot = false;
					$('#bot-messages').hide();
					$('#messages').show();
				}
			});

			socket.on('chat message', function(message) {
				addMessage(message);
			});

			socket.on('bot message', function(message) {
				addBotMessage(message);
			});

			function addMessage(message) {
				if (usingChatbot) {
					$('#bot-messages').append($('<li>').html(`<span class='sender'>Bot</span>${message.text}`));
				} else {
					$('#messages').append($('<li>').html(`<span class='sender'>${message.user}</span>${message.text}`));
				}
			}
		});

		$(document).ready(function() {
			username = localStorage['username'] ? localStorage['username'] : prompt('What name would you like to display?');
			localStorage['username'] = username;
		})
	</script>

	<body>
		<div id="main">
			<div id="left-div">
				<div class="option">General</div>
				<div id="bot" class="option">Bot</div>
			</div>
			<div id="right-div">
				<ul id="messages"></ul>
				<ul id="bot-messages" hidden></ul>
			</div>
		</div>
		<div id="message-container">
			<input id="message-text" autocomplete="off" /><button id="send-button">Send</button>
		</div>
	</body>
</html>
